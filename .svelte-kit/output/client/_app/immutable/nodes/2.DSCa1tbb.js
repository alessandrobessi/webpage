var _t=Object.defineProperty;var dt=(g,t,e)=>t in g?_t(g,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):g[t]=e;var k=(g,t,e)=>dt(g,typeof t!="symbol"?t+"":t,e);import{t as ut,a as z,b as pt}from"../chunks/BUpkqG-s.js";import{i as mt}from"../chunks/dLAi8eeK.js";import{C as gt,F as bt,w as L,K as B,L as $,G as Y,J as j,I as V,f as St,D as Et,M as vt}from"../chunks/Bga2Wgnu.js";import{s as ot}from"../chunks/6eZ0blPR.js";import{i as rt,b as kt}from"../chunks/CrAbsLbI.js";import{o as Ct}from"../chunks/DXR0O3iS.js";/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const y="w",w="b",A="p",et="n",G="b",F="r",O="q",C="k",J="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class H{constructor(t,e){k(this,"color");k(this,"from");k(this,"to");k(this,"piece");k(this,"captured");k(this,"promotion");k(this,"flags");k(this,"san");k(this,"lan");k(this,"before");k(this,"after");const{color:s,piece:i,from:n,to:r,flags:o,captured:a,promotion:h}=e,p=P(n),b=P(r);this.color=s,this.piece=i,this.from=p,this.to=b,this.san=t._moveToSan(e,t._moves({legal:!0})),this.lan=p+b,this.before=t.fen(),t._makeMove(e),this.after=t.fen(),t._undoMove(),this.flags="";for(const l in d)d[l]&o&&(this.flags+=M[l]);a&&(this.captured=a),h&&(this.promotion=h,this.lan+=h)}isCapture(){return this.flags.indexOf(M.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(M.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(M.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(M.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(M.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(M.BIG_PAWN)>-1}}const I=-1,M={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},d={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},st={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},Tt={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},At={...st,...Tt},f={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},Z={b:[16,32,17,15],w:[-16,-32,-17,-15]},at={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Pt=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],yt=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],It={p:1,n:2,b:4,r:8,q:16,k:32},Nt="pnbrqkPNBRQK",lt=[et,G,F,O],wt=7,Rt=6,xt=1,Ot=0,W={[C]:d.KSIDE_CASTLE,[O]:d.QSIDE_CASTLE},R={w:[{square:f.a1,flag:d.QSIDE_CASTLE},{square:f.h1,flag:d.KSIDE_CASTLE}],b:[{square:f.a8,flag:d.QSIDE_CASTLE},{square:f.h8,flag:d.KSIDE_CASTLE}]},Mt={b:xt,w:Rt},qt=["1-0","0-1","1/2-1/2","*"];function q(g){return g>>4}function U(g){return g&15}function ft(g){return"0123456789".indexOf(g)!==-1}function P(g){const t=U(g),e=q(g);return"abcdefgh".substring(t,t+1)+"87654321".substring(e,e+1)}function D(g){return g===y?w:y}function Lt(g){const t=g.split(/\s+/);if(t.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const e=parseInt(t[5],10);if(isNaN(e)||e<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const s=parseInt(t[4],10);if(isNaN(s)||s<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const i=t[0].split("/");if(i.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let r=0;r<i.length;r++){let o=0,a=!1;for(let h=0;h<i[r].length;h++)if(ft(i[r][h])){if(a)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};o+=parseInt(i[r][h],10),a=!0}else{if(!/^[prnbqkPRNBQK]$/.test(i[r][h]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};o+=1,a=!1}if(o!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(t[3][1]=="3"&&t[1]=="w"||t[3][1]=="6"&&t[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const n=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:r,regex:o}of n){if(!o.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${r} king`};if((t[0].match(o)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${r} kings`}}return Array.from(i[0]+i[7]).some(r=>r.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function Kt(g,t){const e=g.from,s=g.to,i=g.piece;let n=0,r=0,o=0;for(let a=0,h=t.length;a<h;a++){const p=t[a].from,b=t[a].to,l=t[a].piece;i===l&&e!==p&&s===b&&(n++,q(e)===q(p)&&r++,U(e)===U(p)&&o++)}return n>0?r>0&&o>0?P(e):o>0?P(e).charAt(1):P(e).charAt(0):""}function x(g,t,e,s,i,n=void 0,r=d.NORMAL){const o=q(s);if(i===A&&(o===wt||o===Ot))for(let a=0;a<lt.length;a++){const h=lt[a];g.push({color:t,from:e,to:s,piece:i,captured:n,promotion:h,flags:r|d.PROMOTION})}else g.push({color:t,from:e,to:s,piece:i,captured:n,flags:r})}function ht(g){let t=g.charAt(0);return t>="a"&&t<="h"?g.match(/[a-h]\d.*[a-h]\d/)?void 0:A:(t=t.toLowerCase(),t==="o"?C:t)}function X(g){return g.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function tt(g){return g.split(" ").slice(0,4).join(" ")}class ct{constructor(t=J,{skipValidation:e=!1}={}){k(this,"_board",new Array(128));k(this,"_turn",y);k(this,"_header",{});k(this,"_kings",{w:I,b:I});k(this,"_epSquare",-1);k(this,"_halfMoves",0);k(this,"_moveNumber",0);k(this,"_history",[]);k(this,"_comments",{});k(this,"_castling",{w:0,b:0});k(this,"_positionCount",{});this.load(t,{skipValidation:e})}clear({preserveHeaders:t=!1}={}){this._board=new Array(128),this._kings={w:I,b:I},this._turn=y,this._castling={w:0,b:0},this._epSquare=I,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=t?this._header:{...At},this._positionCount={},this._header.SetUp=null,this._header.FEN=null}load(t,{skipValidation:e=!1,preserveHeaders:s=!1}={}){let i=t.split(/\s+/);if(i.length>=2&&i.length<6){const o=["-","-","0","1"];t=i.concat(o.slice(-(6-i.length))).join(" ")}if(i=t.split(/\s+/),!e){const{ok:o,error:a}=Lt(t);if(!o)throw new Error(a)}const n=i[0];let r=0;this.clear({preserveHeaders:s});for(let o=0;o<n.length;o++){const a=n.charAt(o);if(a==="/")r+=8;else if(ft(a))r+=parseInt(a,10);else{const h=a<"a"?y:w;this._put({type:a.toLowerCase(),color:h},P(r)),r++}}this._turn=i[1],i[2].indexOf("K")>-1&&(this._castling.w|=d.KSIDE_CASTLE),i[2].indexOf("Q")>-1&&(this._castling.w|=d.QSIDE_CASTLE),i[2].indexOf("k")>-1&&(this._castling.b|=d.KSIDE_CASTLE),i[2].indexOf("q")>-1&&(this._castling.b|=d.QSIDE_CASTLE),this._epSquare=i[3]==="-"?I:f[i[3]],this._halfMoves=parseInt(i[4],10),this._moveNumber=parseInt(i[5],10),this._updateSetup(t),this._incPositionCount(t)}fen(){var n,r;let t=0,e="";for(let o=f.a8;o<=f.h1;o++){if(this._board[o]){t>0&&(e+=t,t=0);const{color:a,type:h}=this._board[o];e+=a===y?h.toUpperCase():h.toLowerCase()}else t++;o+1&136&&(t>0&&(e+=t),o!==f.h1&&(e+="/"),t=0,o+=8)}let s="";this._castling[y]&d.KSIDE_CASTLE&&(s+="K"),this._castling[y]&d.QSIDE_CASTLE&&(s+="Q"),this._castling[w]&d.KSIDE_CASTLE&&(s+="k"),this._castling[w]&d.QSIDE_CASTLE&&(s+="q"),s=s||"-";let i="-";if(this._epSquare!==I){const o=this._epSquare+(this._turn===y?16:-16),a=[o+1,o-1];for(const h of a){if(h&136)continue;const p=this._turn;if(((n=this._board[h])==null?void 0:n.color)===p&&((r=this._board[h])==null?void 0:r.type)===A){this._makeMove({color:p,from:h,to:this._epSquare,piece:A,captured:A,flags:d.EP_CAPTURE});const b=!this._isKingAttacked(p);if(this._undoMove(),b){i=P(this._epSquare);break}}}}return[e,this._turn,s,i,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(t){this._history.length>0||(t!==J?(this._header.SetUp="1",this._header.FEN=t):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(J)}get(t){return this._board[f[t]]}findPiece(t){var s;const e=[];for(let i=f.a8;i<=f.h1;i++){if(i&136){i+=7;continue}!this._board[i]||((s=this._board[i])==null?void 0:s.color)!==t.color||this._board[i].color===t.color&&this._board[i].type===t.type&&e.push(P(i))}return e}put({type:t,color:e},s){return this._put({type:t,color:e},s)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_put({type:t,color:e},s){if(Nt.indexOf(t.toLowerCase())===-1||!(s in f))return!1;const i=f[s];if(t==C&&!(this._kings[e]==I||this._kings[e]==i))return!1;const n=this._board[i];return n&&n.type===C&&(this._kings[n.color]=I),this._board[i]={type:t,color:e},t===C&&(this._kings[e]=i),!0}remove(t){const e=this.get(t);return delete this._board[f[t]],e&&e.type===C&&(this._kings[e.color]=I),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),e}_updateCastlingRights(){var s,i,n,r,o,a,h,p,b,l,v,c;const t=((s=this._board[f.e1])==null?void 0:s.type)===C&&((i=this._board[f.e1])==null?void 0:i.color)===y,e=((n=this._board[f.e8])==null?void 0:n.type)===C&&((r=this._board[f.e8])==null?void 0:r.color)===w;(!t||((o=this._board[f.a1])==null?void 0:o.type)!==F||((a=this._board[f.a1])==null?void 0:a.color)!==y)&&(this._castling.w&=-65),(!t||((h=this._board[f.h1])==null?void 0:h.type)!==F||((p=this._board[f.h1])==null?void 0:p.color)!==y)&&(this._castling.w&=-33),(!e||((b=this._board[f.a8])==null?void 0:b.type)!==F||((l=this._board[f.a8])==null?void 0:l.color)!==w)&&(this._castling.b&=-65),(!e||((v=this._board[f.h8])==null?void 0:v.type)!==F||((c=this._board[f.h8])==null?void 0:c.color)!==w)&&(this._castling.b&=-33)}_updateEnPassantSquare(){var n,r;if(this._epSquare===I)return;const t=this._epSquare+(this._turn===y?-16:16),e=this._epSquare+(this._turn===y?16:-16),s=[e+1,e-1];if(this._board[t]!==null||this._board[this._epSquare]!==null||((n=this._board[e])==null?void 0:n.color)!==D(this._turn)||((r=this._board[e])==null?void 0:r.type)!==A){this._epSquare=I;return}const i=o=>{var a,h;return!(o&136)&&((a=this._board[o])==null?void 0:a.color)===this._turn&&((h=this._board[o])==null?void 0:h.type)===A};s.some(i)||(this._epSquare=I)}_attacked(t,e,s){const i=[];for(let n=f.a8;n<=f.h1;n++){if(n&136){n+=7;continue}if(this._board[n]===void 0||this._board[n].color!==t)continue;const r=this._board[n],o=n-e;if(o===0)continue;const a=o+119;if(Pt[a]&It[r.type]){if(r.type===A){if(o>0&&r.color===y||o<=0&&r.color===w)if(s)i.push(P(n));else return!0;continue}if(r.type==="n"||r.type==="k")if(s){i.push(P(n));continue}else return!0;const h=yt[a];let p=n+h,b=!1;for(;p!==e;){if(this._board[p]!=null){b=!0;break}p+=h}if(!b)if(s){i.push(P(n));continue}else return!0}}return s?i:!1}attackers(t,e){return e?this._attacked(e,f[t],!0):this._attacked(this._turn,f[t],!0)}_isKingAttacked(t){const e=this._kings[t];return e===-1?!1:this._attacked(D(t),e)}isAttacked(t,e){return this._attacked(e,f[t])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const t={b:0,n:0,r:0,q:0,k:0,p:0},e=[];let s=0,i=0;for(let n=f.a8;n<=f.h1;n++){if(i=(i+1)%2,n&136){n+=7;continue}const r=this._board[n];r&&(t[r.type]=r.type in t?t[r.type]+1:1,r.type===G&&e.push(i),s++)}if(s===2)return!0;if(s===3&&(t[G]===1||t[et]===1))return!0;if(s===t[G]+2){let n=0;const r=e.length;for(let o=0;o<r;o++)n+=e[o];if(n===0||n===r)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this.fen())>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:t=!1,square:e=void 0,piece:s=void 0}={}){const i=this._moves({square:e,piece:s});return t?i.map(n=>new H(this,n)):i.map(n=>this._moveToSan(n,i))}_moves({legal:t=!0,piece:e=void 0,square:s=void 0}={}){var v;const i=s?s.toLowerCase():void 0,n=e==null?void 0:e.toLowerCase(),r=[],o=this._turn,a=D(o);let h=f.a8,p=f.h1,b=!1;if(i)if(i in f)h=p=f[i],b=!0;else return[];for(let c=h;c<=p;c++){if(c&136){c+=7;continue}if(!this._board[c]||this._board[c].color===a)continue;const{type:u}=this._board[c];let m;if(u===A){if(n&&n!==u)continue;m=c+Z[o][0],this._board[m]||(x(r,o,c,m,A),m=c+Z[o][1],Mt[o]===q(c)&&!this._board[m]&&x(r,o,c,m,A,void 0,d.BIG_PAWN));for(let S=2;S<4;S++)m=c+Z[o][S],!(m&136)&&(((v=this._board[m])==null?void 0:v.color)===a?x(r,o,c,m,A,this._board[m].type,d.CAPTURE):m===this._epSquare&&x(r,o,c,m,A,A,d.EP_CAPTURE))}else{if(n&&n!==u)continue;for(let S=0,E=at[u].length;S<E;S++){const _=at[u][S];for(m=c;m+=_,!(m&136);){if(!this._board[m])x(r,o,c,m,u);else{if(this._board[m].color===o)break;x(r,o,c,m,u,this._board[m].type,d.CAPTURE);break}if(u===et||u===C)break}}}}if((n===void 0||n===C)&&(!b||p===this._kings[o])){if(this._castling[o]&d.KSIDE_CASTLE){const c=this._kings[o],u=c+2;!this._board[c+1]&&!this._board[u]&&!this._attacked(a,this._kings[o])&&!this._attacked(a,c+1)&&!this._attacked(a,u)&&x(r,o,this._kings[o],u,C,void 0,d.KSIDE_CASTLE)}if(this._castling[o]&d.QSIDE_CASTLE){const c=this._kings[o],u=c-2;!this._board[c-1]&&!this._board[c-2]&&!this._board[c-3]&&!this._attacked(a,this._kings[o])&&!this._attacked(a,c-1)&&!this._attacked(a,u)&&x(r,o,this._kings[o],u,C,void 0,d.QSIDE_CASTLE)}}if(!t||this._kings[o]===-1)return r;const l=[];for(let c=0,u=r.length;c<u;c++)this._makeMove(r[c]),this._isKingAttacked(o)||l.push(r[c]),this._undoMove();return l}move(t,{strict:e=!1}={}){let s=null;if(typeof t=="string")s=this._moveFromSan(t,e);else if(typeof t=="object"){const n=this._moves();for(let r=0,o=n.length;r<o;r++)if(t.from===P(n[r].from)&&t.to===P(n[r].to)&&(!("promotion"in n[r])||t.promotion===n[r].promotion)){s=n[r];break}}if(!s)throw typeof t=="string"?new Error(`Invalid move: ${t}`):new Error(`Invalid move: ${JSON.stringify(t)}`);const i=new H(this,s);return this._makeMove(s),this._incPositionCount(i.after),i}_push(t){this._history.push({move:t,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(t){const e=this._turn,s=D(e);if(this._push(t),this._board[t.to]=this._board[t.from],delete this._board[t.from],t.flags&d.EP_CAPTURE&&(this._turn===w?delete this._board[t.to-16]:delete this._board[t.to+16]),t.promotion&&(this._board[t.to]={type:t.promotion,color:e}),this._board[t.to].type===C){if(this._kings[e]=t.to,t.flags&d.KSIDE_CASTLE){const i=t.to-1,n=t.to+1;this._board[i]=this._board[n],delete this._board[n]}else if(t.flags&d.QSIDE_CASTLE){const i=t.to+1,n=t.to-2;this._board[i]=this._board[n],delete this._board[n]}this._castling[e]=0}if(this._castling[e]){for(let i=0,n=R[e].length;i<n;i++)if(t.from===R[e][i].square&&this._castling[e]&R[e][i].flag){this._castling[e]^=R[e][i].flag;break}}if(this._castling[s]){for(let i=0,n=R[s].length;i<n;i++)if(t.to===R[s][i].square&&this._castling[s]&R[s][i].flag){this._castling[s]^=R[s][i].flag;break}}t.flags&d.BIG_PAWN?e===w?this._epSquare=t.to-16:this._epSquare=t.to+16:this._epSquare=I,t.piece===A?this._halfMoves=0:t.flags&(d.CAPTURE|d.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,e===w&&this._moveNumber++,this._turn=s}undo(){const t=this._undoMove();if(t){const e=new H(this,t);return this._decPositionCount(e.after),e}return null}_undoMove(){const t=this._history.pop();if(t===void 0)return null;const e=t.move;this._kings=t.kings,this._turn=t.turn,this._castling=t.castling,this._epSquare=t.epSquare,this._halfMoves=t.halfMoves,this._moveNumber=t.moveNumber;const s=this._turn,i=D(s);if(this._board[e.from]=this._board[e.to],this._board[e.from].type=e.piece,delete this._board[e.to],e.captured)if(e.flags&d.EP_CAPTURE){let n;s===w?n=e.to-16:n=e.to+16,this._board[n]={type:A,color:i}}else this._board[e.to]={type:e.captured,color:i};if(e.flags&(d.KSIDE_CASTLE|d.QSIDE_CASTLE)){let n,r;e.flags&d.KSIDE_CASTLE?(n=e.to+1,r=e.to-1):(n=e.to-2,r=e.to+1),this._board[n]=this._board[r],delete this._board[r]}return e}pgn({newline:t=`
`,maxWidth:e=0}={}){const s=[];let i=!1;for(const l in this._header)this._header[l]&&s.push(`[${l} "${this._header[l]}"]`+t),i=!0;i&&this._history.length&&s.push(t);const n=l=>{const v=this._comments[this.fen()];if(typeof v<"u"){const c=l.length>0?" ":"";l=`${l}${c}{${v}}`}return l},r=[];for(;this._history.length>0;)r.push(this._undoMove());const o=[];let a="";for(r.length===0&&o.push(n(""));r.length>0;){a=n(a);const l=r.pop();if(!l)break;if(!this._history.length&&l.color==="b"){const v=`${this._moveNumber}. ...`;a=a?`${a} ${v}`:v}else l.color==="w"&&(a.length&&o.push(a),a=this._moveNumber+".");a=a+" "+this._moveToSan(l,this._moves({legal:!0})),this._makeMove(l)}if(a.length&&o.push(n(a)),o.push(this._header.Result||"*"),e===0)return s.join("")+o.join(" ");const h=function(){return s.length>0&&s[s.length-1]===" "?(s.pop(),!0):!1},p=function(l,v){for(const c of v.split(" "))if(c){if(l+c.length>e){for(;h();)l--;s.push(t),l=0}s.push(c),l+=c.length,s.push(" "),l++}return h()&&l--,l};let b=0;for(let l=0;l<o.length;l++){if(b+o[l].length>e&&o[l].includes("{")){b=p(b,o[l]);continue}b+o[l].length>e&&l!==0?(s[s.length-1]===" "&&s.pop(),s.push(t),b=0):l!==0&&(s.push(" "),b++),s.push(o[l]),b+=o[l].length}return s.join("")}header(...t){for(let e=0;e<t.length;e+=2)typeof t[e]=="string"&&typeof t[e+1]=="string"&&(this._header[t[e]]=t[e+1]);return this._header}setHeader(t,e){return this._header[t]=e??st[t]??null,this.getHeaders()}removeHeader(t){return t in this._header?(this._header[t]=st[t]||null,!0):!1}getHeaders(){const t={};for(const[e,s]of Object.entries(this._header))s!==null&&(t[e]=s);return t}loadPgn(t,{strict:e=!1,newlineChar:s=`\r?
`}={}){function i(_){return _.replace(/\\/g,"\\")}function n(_){const T={},N=_.split(new RegExp(i(s)));let K="",it="";for(let Q=0;Q<N.length;Q++){const nt=/^\s*\[\s*([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;K=N[Q].replace(nt,"$1"),it=N[Q].replace(nt,"$2"),K.trim().length>0&&(T[K]=it)}return T}t=t.trim();const o=new RegExp("^(\\[((?:"+i(s)+")|.)*\\])((?:\\s*"+i(s)+"){2}|(?:\\s*"+i(s)+")*$)").exec(t),a=o&&o.length>=2?o[1]:"";this.reset();const h=n(a);let p="";for(const _ in h)_.toLowerCase()==="fen"&&(p=h[_]),this.header(_,h[_]);if(!e)p&&this.load(p,{preserveHeaders:!0});else if(h.SetUp==="1"){if(!("FEN"in h))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(h.FEN,{preserveHeaders:!0})}function b(_){return Array.from(_).map(function(T){return T.charCodeAt(0)<128?T.charCodeAt(0).toString(16):encodeURIComponent(T).replace(/%/g,"").toLowerCase()}).join("")}function l(_){return _.length==0?"":decodeURIComponent("%"+(_.match(/.{1,2}/g)||[]).join("%"))}const v=function(_){return _=_.replace(new RegExp(i(s),"g")," "),`{${b(_.slice(1,_.length-1))}}`},c=function(_){if(_.startsWith("{")&&_.endsWith("}"))return l(_.slice(1,_.length-1))};let u=t.replace(a,"").replace(new RegExp(`({[^}]*})+?|;([^${i(s)}]*)`,"g"),function(_,T,N){return T!==void 0?v(T):" "+v(`{${N.slice(1)}}`)}).replace(new RegExp(i(s),"g")," ");const m=/(\([^()]+\))+?/g;for(;m.test(u);)u=u.replace(m,"");u=u.replace(/\d+\.(\.\.)?/g,""),u=u.replace(/\.\.\./g,""),u=u.replace(/\$\d+/g,"");let S=u.trim().split(new RegExp(/\s+/));S=S.filter(_=>_!=="");let E="";for(let _=0;_<S.length;_++){const T=c(S[_]);if(T!==void 0){this._comments[this.fen()]=T;continue}const N=this._moveFromSan(S[_],e);if(N==null)if(qt.indexOf(S[_])>-1)E=S[_];else throw new Error(`Invalid move in PGN: ${S[_]}`);else E="",this._makeMove(N),this._incPositionCount(this.fen())}E&&Object.keys(this._header).length&&this._header.Result!==E&&this.setHeader("Result",E)}_moveToSan(t,e){let s="";if(t.flags&d.KSIDE_CASTLE)s="O-O";else if(t.flags&d.QSIDE_CASTLE)s="O-O-O";else{if(t.piece!==A){const i=Kt(t,e);s+=t.piece.toUpperCase()+i}t.flags&(d.CAPTURE|d.EP_CAPTURE)&&(t.piece===A&&(s+=P(t.from)[0]),s+="x"),s+=P(t.to),t.promotion&&(s+="="+t.promotion.toUpperCase())}return this._makeMove(t),this.isCheck()&&(this.isCheckmate()?s+="#":s+="+"),this._undoMove(),s}_moveFromSan(t,e=!1){const s=X(t);let i=ht(s),n=this._moves({legal:!0,piece:i});for(let l=0,v=n.length;l<v;l++)if(s===X(this._moveToSan(n[l],n)))return n[l];if(e)return null;let r,o,a,h,p,b=!1;if(o=s.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),o?(r=o[1],a=o[2],h=o[3],p=o[4],a.length==1&&(b=!0)):(o=s.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),o&&(r=o[1],a=o[2],h=o[3],p=o[4],a.length==1&&(b=!0))),i=ht(s),n=this._moves({legal:!0,piece:r||i}),!h)return null;for(let l=0,v=n.length;l<v;l++)if(a){if((!r||r.toLowerCase()==n[l].piece)&&f[a]==n[l].from&&f[h]==n[l].to&&(!p||p.toLowerCase()==n[l].promotion))return n[l];if(b){const c=P(n[l].from);if((!r||r.toLowerCase()==n[l].piece)&&f[h]==n[l].to&&(a==c[0]||a==c[1])&&(!p||p.toLowerCase()==n[l].promotion))return n[l]}}else if(s===X(this._moveToSan(n[l],n)).replace("x",""))return n[l];return null}ascii(){let t=`   +------------------------+
`;for(let e=f.a8;e<=f.h1;e++){if(U(e)===0&&(t+=" "+"87654321"[q(e)]+" |"),this._board[e]){const s=this._board[e].type,n=this._board[e].color===y?s.toUpperCase():s.toLowerCase();t+=" "+n+" "}else t+=" . ";e+1&136&&(t+=`|
`,e+=8)}return t+=`   +------------------------+
`,t+="     a  b  c  d  e  f  g  h",t}perft(t){const e=this._moves({legal:!1});let s=0;const i=this._turn;for(let n=0,r=e.length;n<r;n++)this._makeMove(e[n]),this._isKingAttacked(i)||(t-1>0?s+=this.perft(t-1):s++),this._undoMove();return s}turn(){return this._turn}board(){const t=[];let e=[];for(let s=f.a8;s<=f.h1;s++)this._board[s]==null?e.push(null):e.push({square:P(s),type:this._board[s].type,color:this._board[s].color}),s+1&136&&(t.push(e),e=[],s+=8);return t}squareColor(t){if(t in f){const e=f[t];return(q(e)+U(e))%2===0?"light":"dark"}return null}history({verbose:t=!1}={}){const e=[],s=[];for(;this._history.length>0;)e.push(this._undoMove());for(;;){const i=e.pop();if(!i)break;t?s.push(new H(this,i)):s.push(this._moveToSan(i,this._moves())),this._makeMove(i)}return s}_getPositionCount(t){const e=tt(t);return this._positionCount[e]||0}_incPositionCount(t){const e=tt(t);this._positionCount[e]===void 0&&(this._positionCount[e]=0),this._positionCount[e]+=1}_decPositionCount(t){const e=tt(t);this._positionCount[e]===1?delete this._positionCount[e]:this._positionCount[e]-=1}_pruneComments(){const t=[],e={},s=i=>{i in this._comments&&(e[i]=this._comments[i])};for(;this._history.length>0;)t.push(this._undoMove());for(s(this.fen());;){const i=t.pop();if(!i)break;this._makeMove(i),s(this.fen())}this._comments=e}getComment(){return this._comments[this.fen()]}setComment(t){this._comments[this.fen()]=t.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const t=this._comments[this.fen()];return delete this._comments[this.fen()],t}getComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>({fen:t,comment:this._comments[t]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>{const e=this._comments[t];return delete this._comments[t],{fen:t,comment:e}})}setCastlingRights(t,e){for(const i of[C,O])e[i]!==void 0&&(e[i]?this._castling[t]|=W[i]:this._castling[t]&=~W[i]);this._updateCastlingRights();const s=this.getCastlingRights(t);return(e[C]===void 0||e[C]===s[C])&&(e[O]===void 0||e[O]===s[O])}getCastlingRights(t){return{[C]:(this._castling[t]&W[C])!==0,[O]:(this._castling[t]&W[O])!==0}}moveNumber(){return this._moveNumber}}var Dt=ut(`<div class="puzzle-message svelte-r4tgvx"><p class="svelte-r4tgvx">In a world increasingly reliant on AI to think for us, I believe it's
        vital to keep our minds sharp by embracing challenges. Before you access
        the content, you'll need to solve a chess puzzleâ€”because training your
        brain to tackle hard problems is more important now than ever.</p></div> <h3 class="svelte-r4tgvx">Find the best moves for White.</h3> <p class="hint svelte-r4tgvx"> </p> <div class="chessboard svelte-r4tgvx"></div> <p class="feedback svelte-r4tgvx"> </p>`,1),Ft=pt(`<div class="hidden-content svelte-r4tgvx">ðŸŽ‰ Congratulations! You've solved the puzzle.</div> <script>
      import * as wasm from "@bessimaestro/wasm-game-of-life";
      wasm.greet();
    <\/script>`,1),Ut=ut('<div class="container svelte-r4tgvx"><!> <!></div>');function zt(g,t){gt(t,!1),console.log("Hello there!"),console.log("Puzzle solution: Rh5, a4, Qh6, axb5");let e=B(!1),s=B("Hint: You can threaten checkmate using a rook."),i=B(""),n=B(),r,o=new ct("r4r1k/3qb2n/p2p1pQ1/1bpR4/2p1P3/2N2N1P/PP3PP1/3R2K1 w - - 0 1");function a(u){return new Promise((m,S)=>{const E=document.createElement("script");E.src=u,E.onload=m,E.onerror=S,document.head.appendChild(E)})}function h(u){return new Promise((m,S)=>{const E=document.createElement("link");E.rel="stylesheet",E.href=u,E.integrity="sha384-47VeTDpmy4yT21gKPXQcLQYQZwlmz27gEH5NTrOmTk3G/SGvMyltclOW/Q8uE+sL",E.crossOrigin="anonymous",E.onload=m,E.onerror=S,document.head.appendChild(E)})}Ct(async()=>{await h("https://unpkg.com/@chrisoakman/chessboard2@0.5.0/dist/chessboard2.min.css"),await a("https://unpkg.com/@chrisoakman/chessboard2@0.5.0/dist/chessboard2.min.js"),r=window.Chessboard2(L(n),{position:o.fen(),draggable:!0,onDragStart:(u,m,S,E)=>{if(u.piece.startsWith("b"))return!1},moveSpeed:5,snapbackSpeed:5,snapSpeed:5,onDrop:async(u,m)=>{const S=await fetch("/api/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source:u,target:m,position:o.fen()})}),{success:E,message:_,currentPosition:T,hint:N}=await S.json();E&&$(e,_==="Puzzle solved!"),$(i,_),r.setPosition(T,!0),o=new ct(T),$(s,N)}}),setTimeout(()=>{document.querySelectorAll(".notation-ranks-d3f97 .rank-3d54c").forEach((m,S)=>{m.textContent=8-S})},100)}),mt();var p=Ut(),b=Y(p);{var l=u=>{var m=Dt(),S=j(St(m),4),E=Y(S,!0);V(S);var _=j(S,2);kt(_,K=>$(n,K),()=>L(n));var T=j(_,2),N=Y(T,!0);V(T),Et(()=>{ot(E,L(s)),ot(N,L(i))}),z(u,m)};rt(b,u=>{L(e)||u(l)})}var v=j(b,2);{var c=u=>{var m=Ft();vt(2),z(u,m)};rt(v,u=>{L(e)&&u(c)})}V(p),z(g,p),bt()}export{zt as component};
