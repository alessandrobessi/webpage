var fe=Object.defineProperty;var _e=(m,e,t)=>e in m?fe(m,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[e]=t;var v=(m,e,t)=>_e(m,typeof e!="symbol"?e+"":e,t);import{t as te,a as H}from"../chunks/abR5r1hs.js";import{i as de}from"../chunks/C9ygN-CC.js";import{C as pe,F as me,w as x,K as W,L as G,G as ne,J as z,I as oe,f as ge,D as be}from"../chunks/AfbuXoTy.js";import{s as Se}from"../chunks/BhgL6my-.js";import{i as re,b as Ee}from"../chunks/Dx1usP5A.js";import{o as ve}from"../chunks/Czefwyi5.js";/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const A="w",I="b",C="p",X="n",$="b",F="r",M="q",k="k",Y="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class Q{constructor(e,t){v(this,"color");v(this,"from");v(this,"to");v(this,"piece");v(this,"captured");v(this,"promotion");v(this,"flags");v(this,"san");v(this,"lan");v(this,"before");v(this,"after");const{color:s,piece:i,from:n,to:r,flags:o,captured:a,promotion:c}=t,p=T(n),S=T(r);this.color=s,this.piece=i,this.from=p,this.to=S,this.san=e._moveToSan(t,e._moves({legal:!0})),this.lan=p+S,this.before=e.fen(),e._makeMove(t),this.after=e.fen(),e._undoMove(),this.flags="";for(const l in d)d[l]&o&&(this.flags+=q[l]);a&&(this.captured=a),c&&(this.promotion=c,this.lan+=c)}isCapture(){return this.flags.indexOf(q.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(q.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(q.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(q.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(q.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(q.BIG_PAWN)>-1}}const P=-1,q={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},d={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},ee={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},ke={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},Ce={...ee,...ke},u={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},V={b:[16,32,17,15],w:[-16,-32,-17,-15]},ae={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Te=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Ae=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Pe={p:1,n:2,b:4,r:8,q:16,k:32},ye="pnbrqkPNBRQK",le=[X,$,F,M],we=7,Ie=6,Ne=1,Re=0,B={[k]:d.KSIDE_CASTLE,[M]:d.QSIDE_CASTLE},R={w:[{square:u.a1,flag:d.QSIDE_CASTLE},{square:u.h1,flag:d.KSIDE_CASTLE}],b:[{square:u.a8,flag:d.QSIDE_CASTLE},{square:u.h8,flag:d.KSIDE_CASTLE}]},Oe={b:Ne,w:Ie},Me=["1-0","0-1","1/2-1/2","*"];function L(m){return m>>4}function D(m){return m&15}function ue(m){return"0123456789".indexOf(m)!==-1}function T(m){const e=D(m),t=L(m);return"abcdefgh".substring(e,e+1)+"87654321".substring(t,t+1)}function K(m){return m===A?I:A}function qe(m){const e=m.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const t=parseInt(e[5],10);if(isNaN(t)||t<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const s=parseInt(e[4],10);if(isNaN(s)||s<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const i=e[0].split("/");if(i.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let r=0;r<i.length;r++){let o=0,a=!1;for(let c=0;c<i[r].length;c++)if(ue(i[r][c])){if(a)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};o+=parseInt(i[r][c],10),a=!0}else{if(!/^[prnbqkPRNBQK]$/.test(i[r][c]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};o+=1,a=!1}if(o!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const n=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:r,regex:o}of n){if(!o.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${r} king`};if((e[0].match(o)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${r} kings`}}return Array.from(i[0]+i[7]).some(r=>r.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function Le(m,e){const t=m.from,s=m.to,i=m.piece;let n=0,r=0,o=0;for(let a=0,c=e.length;a<c;a++){const p=e[a].from,S=e[a].to,l=e[a].piece;i===l&&t!==p&&s===S&&(n++,L(t)===L(p)&&r++,D(t)===D(p)&&o++)}return n>0?r>0&&o>0?T(t):o>0?T(t).charAt(1):T(t).charAt(0):""}function O(m,e,t,s,i,n=void 0,r=d.NORMAL){const o=L(s);if(i===C&&(o===we||o===Re))for(let a=0;a<le.length;a++){const c=le[a];m.push({color:e,from:t,to:s,piece:i,captured:n,promotion:c,flags:r|d.PROMOTION})}else m.push({color:e,from:t,to:s,piece:i,captured:n,flags:r})}function he(m){let e=m.charAt(0);return e>="a"&&e<="h"?m.match(/[a-h]\d.*[a-h]\d/)?void 0:C:(e=e.toLowerCase(),e==="o"?k:e)}function J(m){return m.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function Z(m){return m.split(" ").slice(0,4).join(" ")}class ce{constructor(e=Y,{skipValidation:t=!1}={}){v(this,"_board",new Array(128));v(this,"_turn",A);v(this,"_header",{});v(this,"_kings",{w:P,b:P});v(this,"_epSquare",-1);v(this,"_halfMoves",0);v(this,"_moveNumber",0);v(this,"_history",[]);v(this,"_comments",{});v(this,"_castling",{w:0,b:0});v(this,"_positionCount",{});this.load(e,{skipValidation:t})}clear({preserveHeaders:e=!1}={}){this._board=new Array(128),this._kings={w:P,b:P},this._turn=A,this._castling={w:0,b:0},this._epSquare=P,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{...Ce},this._positionCount={},this._header.SetUp=null,this._header.FEN=null}load(e,{skipValidation:t=!1,preserveHeaders:s=!1}={}){let i=e.split(/\s+/);if(i.length>=2&&i.length<6){const o=["-","-","0","1"];e=i.concat(o.slice(-(6-i.length))).join(" ")}if(i=e.split(/\s+/),!t){const{ok:o,error:a}=qe(e);if(!o)throw new Error(a)}const n=i[0];let r=0;this.clear({preserveHeaders:s});for(let o=0;o<n.length;o++){const a=n.charAt(o);if(a==="/")r+=8;else if(ue(a))r+=parseInt(a,10);else{const c=a<"a"?A:I;this._put({type:a.toLowerCase(),color:c},T(r)),r++}}this._turn=i[1],i[2].indexOf("K")>-1&&(this._castling.w|=d.KSIDE_CASTLE),i[2].indexOf("Q")>-1&&(this._castling.w|=d.QSIDE_CASTLE),i[2].indexOf("k")>-1&&(this._castling.b|=d.KSIDE_CASTLE),i[2].indexOf("q")>-1&&(this._castling.b|=d.QSIDE_CASTLE),this._epSquare=i[3]==="-"?P:u[i[3]],this._halfMoves=parseInt(i[4],10),this._moveNumber=parseInt(i[5],10),this._updateSetup(e),this._incPositionCount(e)}fen(){var n,r;let e=0,t="";for(let o=u.a8;o<=u.h1;o++){if(this._board[o]){e>0&&(t+=e,e=0);const{color:a,type:c}=this._board[o];t+=a===A?c.toUpperCase():c.toLowerCase()}else e++;o+1&136&&(e>0&&(t+=e),o!==u.h1&&(t+="/"),e=0,o+=8)}let s="";this._castling[A]&d.KSIDE_CASTLE&&(s+="K"),this._castling[A]&d.QSIDE_CASTLE&&(s+="Q"),this._castling[I]&d.KSIDE_CASTLE&&(s+="k"),this._castling[I]&d.QSIDE_CASTLE&&(s+="q"),s=s||"-";let i="-";if(this._epSquare!==P){const o=this._epSquare+(this._turn===A?16:-16),a=[o+1,o-1];for(const c of a){if(c&136)continue;const p=this._turn;if(((n=this._board[c])==null?void 0:n.color)===p&&((r=this._board[c])==null?void 0:r.type)===C){this._makeMove({color:p,from:c,to:this._epSquare,piece:C,captured:C,flags:d.EP_CAPTURE});const S=!this._isKingAttacked(p);if(this._undoMove(),S){i=T(this._epSquare);break}}}}return[t,this._turn,s,i,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(e){this._history.length>0||(e!==Y?(this._header.SetUp="1",this._header.FEN=e):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(Y)}get(e){return this._board[u[e]]}findPiece(e){var s;const t=[];for(let i=u.a8;i<=u.h1;i++){if(i&136){i+=7;continue}!this._board[i]||((s=this._board[i])==null?void 0:s.color)!==e.color||this._board[i].color===e.color&&this._board[i].type===e.type&&t.push(T(i))}return t}put({type:e,color:t},s){return this._put({type:e,color:t},s)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_put({type:e,color:t},s){if(ye.indexOf(e.toLowerCase())===-1||!(s in u))return!1;const i=u[s];if(e==k&&!(this._kings[t]==P||this._kings[t]==i))return!1;const n=this._board[i];return n&&n.type===k&&(this._kings[n.color]=P),this._board[i]={type:e,color:t},e===k&&(this._kings[t]=i),!0}remove(e){const t=this.get(e);return delete this._board[u[e]],t&&t.type===k&&(this._kings[t.color]=P),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),t}_updateCastlingRights(){var s,i,n,r,o,a,c,p,S,l,E,h;const e=((s=this._board[u.e1])==null?void 0:s.type)===k&&((i=this._board[u.e1])==null?void 0:i.color)===A,t=((n=this._board[u.e8])==null?void 0:n.type)===k&&((r=this._board[u.e8])==null?void 0:r.color)===I;(!e||((o=this._board[u.a1])==null?void 0:o.type)!==F||((a=this._board[u.a1])==null?void 0:a.color)!==A)&&(this._castling.w&=-65),(!e||((c=this._board[u.h1])==null?void 0:c.type)!==F||((p=this._board[u.h1])==null?void 0:p.color)!==A)&&(this._castling.w&=-33),(!t||((S=this._board[u.a8])==null?void 0:S.type)!==F||((l=this._board[u.a8])==null?void 0:l.color)!==I)&&(this._castling.b&=-65),(!t||((E=this._board[u.h8])==null?void 0:E.type)!==F||((h=this._board[u.h8])==null?void 0:h.color)!==I)&&(this._castling.b&=-33)}_updateEnPassantSquare(){var n,r;if(this._epSquare===P)return;const e=this._epSquare+(this._turn===A?-16:16),t=this._epSquare+(this._turn===A?16:-16),s=[t+1,t-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||((n=this._board[t])==null?void 0:n.color)!==K(this._turn)||((r=this._board[t])==null?void 0:r.type)!==C){this._epSquare=P;return}const i=o=>{var a,c;return!(o&136)&&((a=this._board[o])==null?void 0:a.color)===this._turn&&((c=this._board[o])==null?void 0:c.type)===C};s.some(i)||(this._epSquare=P)}_attacked(e,t,s){const i=[];for(let n=u.a8;n<=u.h1;n++){if(n&136){n+=7;continue}if(this._board[n]===void 0||this._board[n].color!==e)continue;const r=this._board[n],o=n-t;if(o===0)continue;const a=o+119;if(Te[a]&Pe[r.type]){if(r.type===C){if(o>0&&r.color===A||o<=0&&r.color===I)if(s)i.push(T(n));else return!0;continue}if(r.type==="n"||r.type==="k")if(s){i.push(T(n));continue}else return!0;const c=Ae[a];let p=n+c,S=!1;for(;p!==t;){if(this._board[p]!=null){S=!0;break}p+=c}if(!S)if(s){i.push(T(n));continue}else return!0}}return s?i:!1}attackers(e,t){return t?this._attacked(t,u[e],!0):this._attacked(this._turn,u[e],!0)}_isKingAttacked(e){const t=this._kings[e];return t===-1?!1:this._attacked(K(e),t)}isAttacked(e,t){return this._attacked(t,u[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},t=[];let s=0,i=0;for(let n=u.a8;n<=u.h1;n++){if(i=(i+1)%2,n&136){n+=7;continue}const r=this._board[n];r&&(e[r.type]=r.type in e?e[r.type]+1:1,r.type===$&&t.push(i),s++)}if(s===2)return!0;if(s===3&&(e[$]===1||e[X]===1))return!0;if(s===e[$]+2){let n=0;const r=t.length;for(let o=0;o<r;o++)n+=t[o];if(n===0||n===r)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this.fen())>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:e=!1,square:t=void 0,piece:s=void 0}={}){const i=this._moves({square:t,piece:s});return e?i.map(n=>new Q(this,n)):i.map(n=>this._moveToSan(n,i))}_moves({legal:e=!0,piece:t=void 0,square:s=void 0}={}){var E;const i=s?s.toLowerCase():void 0,n=t==null?void 0:t.toLowerCase(),r=[],o=this._turn,a=K(o);let c=u.a8,p=u.h1,S=!1;if(i)if(i in u)c=p=u[i],S=!0;else return[];for(let h=c;h<=p;h++){if(h&136){h+=7;continue}if(!this._board[h]||this._board[h].color===a)continue;const{type:f}=this._board[h];let g;if(f===C){if(n&&n!==f)continue;g=h+V[o][0],this._board[g]||(O(r,o,h,g,C),g=h+V[o][1],Oe[o]===L(h)&&!this._board[g]&&O(r,o,h,g,C,void 0,d.BIG_PAWN));for(let b=2;b<4;b++)g=h+V[o][b],!(g&136)&&(((E=this._board[g])==null?void 0:E.color)===a?O(r,o,h,g,C,this._board[g].type,d.CAPTURE):g===this._epSquare&&O(r,o,h,g,C,C,d.EP_CAPTURE))}else{if(n&&n!==f)continue;for(let b=0,y=ae[f].length;b<y;b++){const _=ae[f][b];for(g=h;g+=_,!(g&136);){if(!this._board[g])O(r,o,h,g,f);else{if(this._board[g].color===o)break;O(r,o,h,g,f,this._board[g].type,d.CAPTURE);break}if(f===X||f===k)break}}}}if((n===void 0||n===k)&&(!S||p===this._kings[o])){if(this._castling[o]&d.KSIDE_CASTLE){const h=this._kings[o],f=h+2;!this._board[h+1]&&!this._board[f]&&!this._attacked(a,this._kings[o])&&!this._attacked(a,h+1)&&!this._attacked(a,f)&&O(r,o,this._kings[o],f,k,void 0,d.KSIDE_CASTLE)}if(this._castling[o]&d.QSIDE_CASTLE){const h=this._kings[o],f=h-2;!this._board[h-1]&&!this._board[h-2]&&!this._board[h-3]&&!this._attacked(a,this._kings[o])&&!this._attacked(a,h-1)&&!this._attacked(a,f)&&O(r,o,this._kings[o],f,k,void 0,d.QSIDE_CASTLE)}}if(!e||this._kings[o]===-1)return r;const l=[];for(let h=0,f=r.length;h<f;h++)this._makeMove(r[h]),this._isKingAttacked(o)||l.push(r[h]),this._undoMove();return l}move(e,{strict:t=!1}={}){let s=null;if(typeof e=="string")s=this._moveFromSan(e,t);else if(typeof e=="object"){const n=this._moves();for(let r=0,o=n.length;r<o;r++)if(e.from===T(n[r].from)&&e.to===T(n[r].to)&&(!("promotion"in n[r])||e.promotion===n[r].promotion)){s=n[r];break}}if(!s)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);const i=new Q(this,s);return this._makeMove(s),this._incPositionCount(i.after),i}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(e){const t=this._turn,s=K(t);if(this._push(e),this._board[e.to]=this._board[e.from],delete this._board[e.from],e.flags&d.EP_CAPTURE&&(this._turn===I?delete this._board[e.to-16]:delete this._board[e.to+16]),e.promotion&&(this._board[e.to]={type:e.promotion,color:t}),this._board[e.to].type===k){if(this._kings[t]=e.to,e.flags&d.KSIDE_CASTLE){const i=e.to-1,n=e.to+1;this._board[i]=this._board[n],delete this._board[n]}else if(e.flags&d.QSIDE_CASTLE){const i=e.to+1,n=e.to-2;this._board[i]=this._board[n],delete this._board[n]}this._castling[t]=0}if(this._castling[t]){for(let i=0,n=R[t].length;i<n;i++)if(e.from===R[t][i].square&&this._castling[t]&R[t][i].flag){this._castling[t]^=R[t][i].flag;break}}if(this._castling[s]){for(let i=0,n=R[s].length;i<n;i++)if(e.to===R[s][i].square&&this._castling[s]&R[s][i].flag){this._castling[s]^=R[s][i].flag;break}}e.flags&d.BIG_PAWN?t===I?this._epSquare=e.to-16:this._epSquare=e.to+16:this._epSquare=P,e.piece===C?this._halfMoves=0:e.flags&(d.CAPTURE|d.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,t===I&&this._moveNumber++,this._turn=s}undo(){const e=this._undoMove();if(e){const t=new Q(this,e);return this._decPositionCount(t.after),t}return null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;const t=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber;const s=this._turn,i=K(s);if(this._board[t.from]=this._board[t.to],this._board[t.from].type=t.piece,delete this._board[t.to],t.captured)if(t.flags&d.EP_CAPTURE){let n;s===I?n=t.to-16:n=t.to+16,this._board[n]={type:C,color:i}}else this._board[t.to]={type:t.captured,color:i};if(t.flags&(d.KSIDE_CASTLE|d.QSIDE_CASTLE)){let n,r;t.flags&d.KSIDE_CASTLE?(n=t.to+1,r=t.to-1):(n=t.to-2,r=t.to+1),this._board[n]=this._board[r],delete this._board[r]}return t}pgn({newline:e=`
`,maxWidth:t=0}={}){const s=[];let i=!1;for(const l in this._header)this._header[l]&&s.push(`[${l} "${this._header[l]}"]`+e),i=!0;i&&this._history.length&&s.push(e);const n=l=>{const E=this._comments[this.fen()];if(typeof E<"u"){const h=l.length>0?" ":"";l=`${l}${h}{${E}}`}return l},r=[];for(;this._history.length>0;)r.push(this._undoMove());const o=[];let a="";for(r.length===0&&o.push(n(""));r.length>0;){a=n(a);const l=r.pop();if(!l)break;if(!this._history.length&&l.color==="b"){const E=`${this._moveNumber}. ...`;a=a?`${a} ${E}`:E}else l.color==="w"&&(a.length&&o.push(a),a=this._moveNumber+".");a=a+" "+this._moveToSan(l,this._moves({legal:!0})),this._makeMove(l)}if(a.length&&o.push(n(a)),o.push(this._header.Result||"*"),t===0)return s.join("")+o.join(" ");const c=function(){return s.length>0&&s[s.length-1]===" "?(s.pop(),!0):!1},p=function(l,E){for(const h of E.split(" "))if(h){if(l+h.length>t){for(;c();)l--;s.push(e),l=0}s.push(h),l+=h.length,s.push(" "),l++}return c()&&l--,l};let S=0;for(let l=0;l<o.length;l++){if(S+o[l].length>t&&o[l].includes("{")){S=p(S,o[l]);continue}S+o[l].length>t&&l!==0?(s[s.length-1]===" "&&s.pop(),s.push(e),S=0):l!==0&&(s.push(" "),S++),s.push(o[l]),S+=o[l].length}return s.join("")}header(...e){for(let t=0;t<e.length;t+=2)typeof e[t]=="string"&&typeof e[t+1]=="string"&&(this._header[e[t]]=e[t+1]);return this._header}setHeader(e,t){return this._header[e]=t??ee[e]??null,this.getHeaders()}removeHeader(e){return e in this._header?(this._header[e]=ee[e]||null,!0):!1}getHeaders(){const e={};for(const[t,s]of Object.entries(this._header))s!==null&&(e[t]=s);return e}loadPgn(e,{strict:t=!1,newlineChar:s=`\r?
`}={}){function i(_){return _.replace(/\\/g,"\\")}function n(_){const w={},N=_.split(new RegExp(i(s)));let j="",se="";for(let U=0;U<N.length;U++){const ie=/^\s*\[\s*([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;j=N[U].replace(ie,"$1"),se=N[U].replace(ie,"$2"),j.trim().length>0&&(w[j]=se)}return w}e=e.trim();const o=new RegExp("^(\\[((?:"+i(s)+")|.)*\\])((?:\\s*"+i(s)+"){2}|(?:\\s*"+i(s)+")*$)").exec(e),a=o&&o.length>=2?o[1]:"";this.reset();const c=n(a);let p="";for(const _ in c)_.toLowerCase()==="fen"&&(p=c[_]),this.header(_,c[_]);if(!t)p&&this.load(p,{preserveHeaders:!0});else if(c.SetUp==="1"){if(!("FEN"in c))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(c.FEN,{preserveHeaders:!0})}function S(_){return Array.from(_).map(function(w){return w.charCodeAt(0)<128?w.charCodeAt(0).toString(16):encodeURIComponent(w).replace(/%/g,"").toLowerCase()}).join("")}function l(_){return _.length==0?"":decodeURIComponent("%"+(_.match(/.{1,2}/g)||[]).join("%"))}const E=function(_){return _=_.replace(new RegExp(i(s),"g")," "),`{${S(_.slice(1,_.length-1))}}`},h=function(_){if(_.startsWith("{")&&_.endsWith("}"))return l(_.slice(1,_.length-1))};let f=e.replace(a,"").replace(new RegExp(`({[^}]*})+?|;([^${i(s)}]*)`,"g"),function(_,w,N){return w!==void 0?E(w):" "+E(`{${N.slice(1)}}`)}).replace(new RegExp(i(s),"g")," ");const g=/(\([^()]+\))+?/g;for(;g.test(f);)f=f.replace(g,"");f=f.replace(/\d+\.(\.\.)?/g,""),f=f.replace(/\.\.\./g,""),f=f.replace(/\$\d+/g,"");let b=f.trim().split(new RegExp(/\s+/));b=b.filter(_=>_!=="");let y="";for(let _=0;_<b.length;_++){const w=h(b[_]);if(w!==void 0){this._comments[this.fen()]=w;continue}const N=this._moveFromSan(b[_],t);if(N==null)if(Me.indexOf(b[_])>-1)y=b[_];else throw new Error(`Invalid move in PGN: ${b[_]}`);else y="",this._makeMove(N),this._incPositionCount(this.fen())}y&&Object.keys(this._header).length&&this._header.Result!==y&&this.setHeader("Result",y)}_moveToSan(e,t){let s="";if(e.flags&d.KSIDE_CASTLE)s="O-O";else if(e.flags&d.QSIDE_CASTLE)s="O-O-O";else{if(e.piece!==C){const i=Le(e,t);s+=e.piece.toUpperCase()+i}e.flags&(d.CAPTURE|d.EP_CAPTURE)&&(e.piece===C&&(s+=T(e.from)[0]),s+="x"),s+=T(e.to),e.promotion&&(s+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?s+="#":s+="+"),this._undoMove(),s}_moveFromSan(e,t=!1){const s=J(e);let i=he(s),n=this._moves({legal:!0,piece:i});for(let l=0,E=n.length;l<E;l++)if(s===J(this._moveToSan(n[l],n)))return n[l];if(t)return null;let r,o,a,c,p,S=!1;if(o=s.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),o?(r=o[1],a=o[2],c=o[3],p=o[4],a.length==1&&(S=!0)):(o=s.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),o&&(r=o[1],a=o[2],c=o[3],p=o[4],a.length==1&&(S=!0))),i=he(s),n=this._moves({legal:!0,piece:r||i}),!c)return null;for(let l=0,E=n.length;l<E;l++)if(a){if((!r||r.toLowerCase()==n[l].piece)&&u[a]==n[l].from&&u[c]==n[l].to&&(!p||p.toLowerCase()==n[l].promotion))return n[l];if(S){const h=T(n[l].from);if((!r||r.toLowerCase()==n[l].piece)&&u[c]==n[l].to&&(a==h[0]||a==h[1])&&(!p||p.toLowerCase()==n[l].promotion))return n[l]}}else if(s===J(this._moveToSan(n[l],n)).replace("x",""))return n[l];return null}ascii(){let e=`   +------------------------+
`;for(let t=u.a8;t<=u.h1;t++){if(D(t)===0&&(e+=" "+"87654321"[L(t)]+" |"),this._board[t]){const s=this._board[t].type,n=this._board[t].color===A?s.toUpperCase():s.toLowerCase();e+=" "+n+" "}else e+=" . ";t+1&136&&(e+=`|
`,t+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const t=this._moves({legal:!1});let s=0;const i=this._turn;for(let n=0,r=t.length;n<r;n++)this._makeMove(t[n]),this._isKingAttacked(i)||(e-1>0?s+=this.perft(e-1):s++),this._undoMove();return s}turn(){return this._turn}board(){const e=[];let t=[];for(let s=u.a8;s<=u.h1;s++)this._board[s]==null?t.push(null):t.push({square:T(s),type:this._board[s].type,color:this._board[s].color}),s+1&136&&(e.push(t),t=[],s+=8);return e}squareColor(e){if(e in u){const t=u[e];return(L(t)+D(t))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const t=[],s=[];for(;this._history.length>0;)t.push(this._undoMove());for(;;){const i=t.pop();if(!i)break;e?s.push(new Q(this,i)):s.push(this._moveToSan(i,this._moves())),this._makeMove(i)}return s}_getPositionCount(e){const t=Z(e);return this._positionCount[t]||0}_incPositionCount(e){const t=Z(e);this._positionCount[t]===void 0&&(this._positionCount[t]=0),this._positionCount[t]+=1}_decPositionCount(e){const t=Z(e);this._positionCount[t]===1?delete this._positionCount[t]:this._positionCount[t]-=1}_pruneComments(){const e=[],t={},s=i=>{i in this._comments&&(t[i]=this._comments[i])};for(;this._history.length>0;)e.push(this._undoMove());for(s(this.fen());;){const i=e.pop();if(!i)break;this._makeMove(i),s(this.fen())}this._comments=t}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const t=this._comments[e];return delete this._comments[e],{fen:e,comment:t}})}setCastlingRights(e,t){for(const i of[k,M])t[i]!==void 0&&(t[i]?this._castling[e]|=B[i]:this._castling[e]&=~B[i]);this._updateCastlingRights();const s=this.getCastlingRights(e);return(t[k]===void 0||t[k]===s[k])&&(t[M]===void 0||t[M]===s[M])}getCastlingRights(e){return{[k]:(this._castling[e]&B[k])!==0,[M]:(this._castling[e]&B[M])!==0}}moveNumber(){return this._moveNumber}}var xe=te(`<div class="puzzle-message svelte-v1owbg"><p class="svelte-v1owbg">In a world increasingly reliant on AI to think for us, I believe it's
        vital to keep our minds sharp by embracing challenges. Before you access
        the content, you'll need to solve a chess puzzle—because training your
        brain to tackle hard problems is more important now than ever.</p></div> <h3 class="svelte-v1owbg">Find the best moves for White.</h3> <p class="svelte-v1owbg">Hint: You can win one of the Black bishops.</p> <div class="chessboard svelte-v1owbg"></div> <p class="feedback svelte-v1owbg"> </p>`,1),Ke=te(`<div class="hidden-content svelte-v1owbg">🎉 Congratulations! You've solved the puzzle.</div>`),Fe=te('<div class="container svelte-v1owbg"><!> <!></div>');function We(m,e){pe(e,!1);let t=W(!1),s=W(""),i=W(),n,r=new ce("r4r1k/3qb2n/p2p1pQ1/1bpR4/2p1P3/2N2N1P/PP3PP1/3R2K1 w - - 0 1");function o(h){return new Promise((f,g)=>{const b=document.createElement("script");b.src=h,b.onload=f,b.onerror=g,document.head.appendChild(b)})}function a(h){return new Promise((f,g)=>{const b=document.createElement("link");b.rel="stylesheet",b.href=h,b.integrity="sha384-47VeTDpmy4yT21gKPXQcLQYQZwlmz27gEH5NTrOmTk3G/SGvMyltclOW/Q8uE+sL",b.crossOrigin="anonymous",b.onload=f,b.onerror=g,document.head.appendChild(b)})}ve(async()=>{await a("https://unpkg.com/@chrisoakman/chessboard2@0.5.0/dist/chessboard2.min.css"),await o("https://unpkg.com/@chrisoakman/chessboard2@0.5.0/dist/chessboard2.min.js"),n=window.Chessboard2(x(i),{position:r.fen(),draggable:!0,moveSpeed:"slow",snapbackSpeed:500,snapSpeed:100,onDrop:async(h,f)=>{const g=await fetch("/api/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source:h,target:f,position:r.fen()})}),{success:b,message:y,currentPosition:_}=await g.json();b&&G(t,y==="Puzzle solved!"),G(s,y),n.setPosition(_,!0),r=new ce(_)}}),setTimeout(()=>{document.querySelectorAll(".notation-ranks-d3f97 .rank-3d54c").forEach((f,g)=>{f.textContent=8-g})},100)}),de();var c=Fe(),p=ne(c);{var S=h=>{var f=xe(),g=z(ge(f),6);Ee(g,_=>G(i,_),()=>x(i));var b=z(g,2),y=ne(b,!0);oe(b),be(()=>Se(y,x(s))),H(h,f)};re(p,h=>{x(t)||h(S)})}var l=z(p,2);{var E=h=>{var f=Ke();H(h,f)};re(l,h=>{x(t)&&h(E)})}oe(c),H(m,c),me()}export{We as component};
